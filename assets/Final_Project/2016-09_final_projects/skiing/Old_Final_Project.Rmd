---
title: "Where should you ski this winter?"-Final Project"
author: "Maddie Maloney and Sophia Konanc"
date: "Sunday December 18th, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load all necessary packages here
library(ggplot2)
library(dplyr)
library(mosaic)
library(lubridate)
library(knitr)
Stowe.Snowfall <- read.csv("~/problem_sets/Stowe Snowfall.csv")
Killington.Snowfall <- read.csv("~/problem_sets/Killington Snowfall.csv")
Sugarbush.Snowfall <- read.csv("~/problem_sets/Sugarbush Snowfall.csv")

# Load all datasets
Killington <- read.csv("/home/skonanc/problem_sets/Killington Snowfall.csv") %>% 
  mutate(resort="Killington")
Stowe <- read.csv("/home/skonanc/problem_sets/Stowe Snowfall.csv") %>% 
  mutate(resort="Stowe")
Sugarbush <- read.csv("/home/skonanc/problem_sets/Sugarbush Snowfall.csv") %>% 
  mutate(resort="Sugarbush")
January_weather <- read.csv("/home/skonanc/problem_sets/January_weather.csv")
elnino <- read.csv("/home/skonanc/problem_sets/elnino.csv")

# Mutate and filter
winter_snowfall <- snowfall %>% filter(Month=="October" | Month=="November" | Month=="December" | Month=="January" | Month=="February" | Month=="March" | Month=="April")
January_snowfall <- snowfall %>% filter(Month=="January")
snowfall <- bind_rows(Killington, Stowe, Sugarbush) %>% 
  as_data_frame() %>% 
  mutate(
    Month = as.character(Month), 
    Day = "01",
    date = paste(Year, Month, Day, sep="-")
  ) %>% 
  mutate(date = lubridate::parse_date_time(date, "Y-Om!-d"))
January_snowfall <- January_snowfall %>% 
  as_data_frame() %>% 
  mutate(
    Month = as.character(Month), 
    Day = "01",
    date = paste(Year, Month, Day, sep="-")
  ) %>% 
  mutate(date = lubridate::parse_date_time(date, "Y-Om!-d"))
January_weather <- January_weather %>% 
  as_data_frame() %>% 
  mutate(
    Month = as.character(Month), 
    Day = "01",
    date = paste(Year, Month, Day, sep="-")
  ) %>% 
  mutate(date = lubridate::parse_date_time(date, "Y-Om!-d"))
January <- left_join(January_snowfall, January_weather, by = c("Month", "Year", "resort", "Day", "date"))

elnino <- elnino %>% 
  as_data_frame() %>% 
  mutate(
    Month = as.character(Month), 
    Day = "01",
    date = paste(Year, Month, Day, sep="-")
  ) %>% 
  mutate(date = lubridate::parse_date_time(date, "Y-Om!-d"))

elninoallseason <- left_join(winter_snowfall, elnino, by = c("Month", "Year", "Day", "date"))
elninoallseason <- elninoallseason %>% filter(Snowfall != 0)
View(elninoallseason)
elninoJanuary <- elnino %>% filter(Month=="January")
January <- left_join(January, elninoJanuary, by = c("Month", "Year", "Day", "date"))



```





## Main Article

## Intro

Resorts and Middlebury students alike have been hyping this year's ski season, perhaps in reaction to last year's lackluster snowfall totals. Many factors go into determining where Middlebury students choose to ski: proximity to campus, the price of lift passes, and childhood experiences, to name a few. Students often frequent Killington, Sugarbush, and Stowe, so we analyzed data for those three mountains to help Middlebury students choose where to ski. While you might not value data over your emotional ties to a particular mountain, here are some trends to consider when planning the perfect day of shredding.

## Snowfall Trends
For the discerning powder hounds among us
Killington: 1700 snow guns-the best system, why they hosted the Ski World Cup
Stowe: 
Sugarbush:

## Temperature and Wind during January
There's nothing worse than a day on the slopes being foiled by lift closures. To determine where winds are most likely to be high enough to be dangerous and warrant lift closures, we assigned each resort a wind score. The wind score is the product of the average number of January gust events and the average January maximum gust speed. Killington has the highest wind score, but you should also take temperature into consideration. 

## La Nina
```{r, message=FALSE, warning=FALSE, fig.width=8, fig.height=4.5, echo=FALSE}
ggplot(January, aes(x=Year, y=Snowfall, fill=La.Nina)) +
  geom_bar(stat = "identity")
```

In addition to the factors that typically affect snowfall, meteorologists predict La Nina will enter into the mix this winter. The term La Nina describes the phenomenon when temperatures in the Pacific Ocean near the equator become cooler than normal by more than 0.5 degrees C. The temperature change affects where the most air evaporates, which changes the location of the jetstream. The jetstream influences where storms will occur, and consequently how much snow different parts of the world receive. For the United States, La Nina usually causes the jetstream and storm track to shift north and more snow to fall in the country's northern third. However, La Nina is not pushing the jetstream far enough north to reach Vermont this year, and this season's La Nina is expected to be weak to moderate. In fact, in recent years La Nina has not been a determining factor in how much snowfall Vermont gets.  If La Nina was the main determining factor in snowfall this year, you might find more snow the farther north you go in the state, but snow storms also crop up due to somewhat random, unpredictable factors. If you have many resort options from which to choose, your best bet for above-average snowfall in a La Nina year is the Pacific Northwest because of this year's jetstream trajectory. As far as Vermont goes, La Nina should not significantly affect snowfall at ski mountains positively or negatively. 


```{r, message=FALSE, warning=FALSE, fig.width=8, fig.height=4.5, echo=FALSE}
# Copy this blank code block as many times as you need. Note, if you want to
# code to show in your HTML files, set echo=TRUE above.
ggplot(January, aes(x=Year, y=Snowfall, color=resort)) +
   geom_line()
ggplot(January, aes(x=Year, y=Snowfall, color=resort)) +
   geom_point() +
   geom_smooth(span=0.6, se=FALSE)
ggplot(January, aes(x=resort, y=Snowfall)) +
  geom_boxplot()
ggplot(January, aes(x=Year, y=Snowfall, color=El.Nino)) +
  geom_bar(stat = "identity")

ggplot(January, aes(x=Year, y=Snowfall, fill=resort)) +
  geom_bar(stat ="identity", position = "dodge")


```




For those who would like to know more about how we conducted our analysis, we have included some supplementary materials below.
##Supplementary Materials
We conducted two hypothesis tests to determine if La Nina or El Nino affected average snowfall totals in the winter at Sugarbush, Stowe, and Killington. When the La Nina condition was true, snowfall totals were actually less. The p-value for the La Nina test was 0.001. We reject our null hypothesis, that La Nina has no affect on snowfall totals in Vermont, in favor of the alternate hypothesis that in La Nina years Vermont gets less snowfall on average. This is surprising, but could perhaps be explained by the fact that our data only went far back enough to include weak to mild La Nina events rather than strong ones. Additionally, we included October and November of 2016, which had relatively low snowfall totals. The Pacific Ocean has not cooled as much as researchers predicted, which could be why La Nina's effects have yet to be felt much by the United States this winter.     

The hypothesis test for El Nino and snowfall totals had a p-value of 0.126, rendering it not statistically significant. We fail to reject our null hypothesis that El Nino does not impact snowfall totals in Vermont.
```{r, message=FALSE, warning=FALSE, fig.width=8, fig.height=4.5, echo=FALSE}

# Exploratory Data Analysis
ggplot(data=elninoallseason, aes(x=La.Nina, y=Snowfall)) +
  geom_boxplot() + facet_wrap(~resort)
ggplot(data=elninoallseason, aes(x=El.Nino, y=Snowfall)) +
  geom_boxplot() + facet_wrap(~resort)


# Hypothesis testing for el nino and la nina
lanina_avg <- elninoallseason %>% group_by(La.Nina) %>% summarize(avg_snowfall = mean(Snowfall))
kable(lanina_avg)
elnino_avg <- elninoallseason %>% group_by(El.Nino) %>% summarize(avg_snowfall = mean(Snowfall))
kable(elnino_avg)

observed_diff_lanina <- mean(Snowfall ~ La.Nina, data=elninoallseason) %>% diff()

observed_diff_elnino <- mean(Snowfall ~ El.Nino, data=elninoallseason) %>% diff()


simulations.lanina <- do(10000) * mean(Snowfall ~ shuffle(La.Nina), data=elninoallseason)
simulations.lanina <- simulations.lanina %>%
  as_data_frame() %>% 
  mutate(difference=t-f)


ggplot(data=simulations.lanina , aes(x=difference)) +
  geom_histogram() +
  geom_vline(xintercept = observed_diff_lanina, col="red") +
  geom_vline(xintercept = 0, linetype="dashed") +
  labs(x="Difference: True Avg - False Avg")

simulations.lanina %>%
  mutate(more_extreme_left = difference <= observed_diff_lanina) %>% 
  summarise(more_extreme_left = sum(more_extreme_left))

simulations.elnino <- do(10000) * mean(Snowfall ~ shuffle(El.Nino), data=elninoallseason)
simulations.elnino <- simulations.elnino %>%
  as_data_frame() %>% 
  mutate(difference=t-f)

ggplot(data=simulations.elnino , aes(x=difference)) +
  geom_histogram() +
  geom_vline(xintercept = observed_diff_elnino, col="red") +
  geom_vline(xintercept = 0, linetype="dashed") +
  labs(x="Difference: True Avg - False Avg")
simulations.elnino %>%
  mutate(more_extreme_right = difference >= observed_diff_elnino) %>% 
  summarise(more_extreme_right = sum(more_extreme_right))

```
##Sources: 
http://www.cpc.noaa.gov/products/analysis_monitoring/ensostuff/ensoyears.shtml
https://www.wunderground.com/history/airport/KMVL/2009/12/14/MonthlyHistory.html?req_city=Morrisville&req_state=VT&req_statename=&reqdb.zip=05672&reqdb.magic=2&reqdb.wmo=99999&MR=1
http://www.onthesnow.com/news/a/584883/how-does-la-niña-drive-snowfall-in-u-s--
http://www.onthesnow.com/news/a/620741/what-la-niña-has-in-store-for-winter-2016-2017
http://skivermont.com/skivt-blog/1800/2016/09/27/winters-best-kept-secret-world-class-snowmaking-in-vermont/
```{r, message=FALSE, warning=FALSE, fig.width=8, fig.height=4.5, echo=FALSE}


```


